#!/bin/bash

mkdir -p pokemon_data
pokemon_list=(bulbasaur ivysaur venusaur charmander charmeleon)

fetch() {
  name=$1
  echo "Fetching $name..."
  curl -s -o "pokemon_data/$name.json" --fail "https://pokeapi.co/api/v2/pokemon/$name" &&
  echo "Saved $name" ||
  echo "Failed to fetch $name" >> errors.txt
}

pids=()

for pokemon in "${pokemon_list[@]}"; do
  fetch "$pokemon" &
  pids+=($!)  # save PID of background process
done

jobs  # list background jobs

# Wait with timeout (e.g., 10 seconds) for each job, kill if still running
for pid in "${pids[@]}"; do
  timeout=10
  while kill -0 "$pid" 2>/dev/null && (( timeout > 0 )); do
    sleep 1
    ((timeout--))
  done

  if kill -0 "$pid" 2>/dev/null; then
    echo "Process $pid timed out. Killing..."
    kill -9 "$pid"
  fi
done

wait
echo "All Pok√©mon fetched!"
